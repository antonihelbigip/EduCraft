<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EduCraft – Minecraft OZE</title>
  <link rel="stylesheet" href="style.css">
  <meta name="description" content="EduCraft – educational Minecraft server powered by renewable energy.">

  <!-- Favicon -->
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="favicon.png">

  <!-- Open Graph (zastąp, kiedy będziesz miał domenę) -->
  <meta property="og:title" content="EduCraft – Minecraft OZE" />
  <meta property="og:description" content="Pierwszy w Polsce edukacyjny serwer Minecraft zasilany w 100% energią odnawialną." />
  <meta property="og:image" content="https://twoja-domena.pl/tlo.jpg" />
  <meta property="og:url" content="https://twoja-domena.pl/" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="EduCraft – Minecraft OZE" />
  <meta name="twitter:description" content="Minecraft + OZE + edukacja. Dołącz!" />
  <meta name="twitter:image" content="https://twoja-domena.pl/tlo.jpg" />

  <!-- marked.js do renderowania Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <!-- TOPBAR — pełna szerokość, wewnętrzny container centrowany -->
  <div class="topbar" role="navigation" aria-label="Główna nawigacja">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:12px;padding:0.5rem 0;">
      <div style="display:flex;align-items:center;gap:12px;">
        <a class="brand" href="#home" aria-label="EduCraft">EduCraft</a>

        <!-- mobile toggle -->
        <button class="nav-toggle" aria-expanded="false" aria-label="Otwórz menu">
          <span></span><span></span><span></span>
        </button>

        <nav class="main-nav" role="navigation" aria-label="Główna nawigacja">
          <ul>
            <li><a href="#about" data-i18n="nav_about">O projekcie</a></li>
            <li><a href="#education" data-i18n="nav_education">Edukacja</a></li>
            <li><a href="#publications" data-i18n="nav_publications">Publikacje</a></li>
            <li><a href="#projects" data-i18n="nav_projects">Projekty</a></li>
            <li><a href="#multimedia" data-i18n="nav_multimedia">Multimedia</a></li>
            <li><a href="#blog" data-i18n="nav_blog">Blog</a></li>
            <li><a href="#contact" data-i18n="nav_contact">Kontakt</a></li>
          </ul>
        </nav>
      </div>

      <div class="right-group" style="display:flex;align-items:center;gap:.6rem;">
        <div class="lang-switch" aria-hidden="false">
          <button class="lang-btn" data-lang="pl" title="Polski">PL</button>
          <button class="lang-btn" data-lang="en" title="English">EN</button>
          <button class="lang-btn" data-lang="de" title="Deutsch">DE</button>
        </div>
        <a id="cta-support" class="btn btn-primary" href="https://zrzutka.pl/b5j6vm" target="_blank" rel="noopener" data-i18n="cta_support">Wesprzyj</a>
      </div>
    </div>
  </div>

  <!-- HERO (tylko tło, bez tekstów/przycisków) -->
  <header class="hero" id="home" role="banner" aria-label="Hero">
    <div class="hero-inner container">
      <!-- intentionally empty: no hero text/buttons as requested -->
    </div>
  </header>

  <main class="container" role="main" style="padding-top:18px;">
    <!-- ABOUT -->
    <section id="about" class="card" aria-labelledby="about-heading">
      <h2 id="about-heading" data-i18n="about_title">O projekcie</h2>
      <p data-i18n="about_text">
       Buduję pierwszy w Polsce edukacyjny serwer Minecraft zasilany w 100% odnawialną energią. To połączenie gier, technologii i ekologii — z misją edukacyjną dla dzieci, młodzieży i dorosłych. Pomóż mi uruchomić ten wyjątkowy projekt i pokażmy, że Minecraft może zmieniać świat!
      </p>
    </section>

    <!-- EDUCATION 
    <section id="education" class="card muted" aria-labelledby="education-heading">
      <h3 id="education-heading" data-i18n="education_title">Edukacja</h3>
      <p data-i18n="education_text">Materiały edukacyjne i scenariusze lekcji: energia słoneczna, wiatr, magazynowanie, monitoring i automatyka (Home Assistant).</p>
      <ul>
        <li>Lesson: Solar Basics</li>
        <li>Lesson: Wind Energy</li>
        <li>Lesson: Monitoring & Home Assistant</li>
      </ul>
    </section> -->

    <!-- PUBLICATIONS (możesz później przerobić na "Aktualizacje", jeśli wolisz) 
    <section id="publications" class="card" aria-labelledby="publications-heading">
      <h3 id="publications-heading" data-i18n="publications_title">Publikacje</h3>
      <p data-i18n="publications_intro">Lista raportów, artykułów i materiałów edukacyjnych związanych z projektem.</p>
      <div class="table-wrap" style="overflow:auto;margin-top:1rem;">
        <table class="pub-table" style="width:100%;border-collapse:collapse;">
          <thead>
            <tr>
              <th style="text-align:left;padding:.6rem;border-bottom:1px solid #eee">Rok</th>
              <th style="text-align:left;padding:.6rem;border-bottom:1px solid #eee">Tytuł</th>
              <th style="text-align:left;padding:.6rem;border-bottom:1px solid #eee">Typ</th>
              <th style="text-align:left;padding:.6rem;border-bottom:1px solid #eee">Link</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding:.6rem;border-bottom:1px solid #f1f1f1">2025</td>
              <td style="padding:.6rem;border-bottom:1px solid #f1f1f1">EduCraft — raport wdrożenia OZE</td>
              <td style="padding:.6rem;border-bottom:1px solid #f1f1f1">Raport</td>
              <td style="padding:.6rem;border-bottom:1px solid #f1f1f1">GitHub</td>
            </tr>
            <tr>
              <td style="padding:.6rem;border-bottom:1px solid #f1f1f1">2024</td>
              <td style="padding:.6rem;border-bottom:1px solid #f1f1f1">Scenariusze lekcji: Energia w praktyce</td>
              <td style="padding:.6rem;border-bottom:1px solid #f1f1f1">Materiały</td>
              <td style="padding:.6rem;border-bottom:1px solid #f1f1f1">PDF</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>  -->

    <!-- CREATOR -->
    <section id="creator" class="card muted" aria-labelledby="creator-heading">
      <h3 id="creator-heading" data-i18n="creator_title">Kim jestem?</h3>
      <p data-i18n="creator_text">Mam na imię Antoni — jestem studentem mechatroniki na Politechnice Śląskiej, stażystą ds. sztucznej inteligencji w firmie Siemens oraz trzykrotnym laureatem konkursu „Mój pomysł na biznes”. Ten projekt to dla mnie coś więcej niż hobby — to marzenie o łączeniu zabawy z nauką, i realna szansa na pokazanie, że OZE to nie przyszłość – to teraźniejszość.”.</p>
    </section>

    <!-- BUILD 
    <section id="build" class="card" aria-labelledby="build-heading">
      <h3 id="build-heading" data-i18n="build_title">Co buduję?</h3>
      <ul>
        <li data-i18n="build_li1">Serwer 24/7 zasilany panelami PV i turbiną wiatrową</li>
        <li data-i18n="build_li2">Platforma edukacyjna z zadaniami, NPC/AI i mapą EarthMC</li>
        <li data-i18n="build_li3">System monitoringu energii (Raspberry Pi + Home Assistant)</li>
      </ul>
  </section  -->

  <section id="build" class="card" aria-labelledby="build-heading">
    <h3 id="build-heading" data-i18n="build_title">Co buduję?</h3>
      <p data-i18n="build_intro">
    Otwarto-edukacyjny serwer Minecraft, który:
      </p>
      <ul>
        <li data-i18n="build_li1">Działa 24/7 dzięki energii z paneli słonecznych </li>
        <li data-i18n="build_li2">Służy jako platforma edukacyjna z zadaniami i grami o OZE, fizyce i automatyce NPC/AI i mapą EarthMC</li>
        <li data-i18n="build_li3">Uczy, jak naprawdę działają systemy energii odnawialnej, system monitoringu energii (Raspberry Pi + Home Assistant)</li>
      </ul>
  </section>


    <!-- PROJECTS 
    <section id="projects" class="card muted" aria-labelledby="projects-heading">
      <h3 id="projects-heading" data-i18n="projects_title">Projekty</h3>
      <ul>
        <li>SunBlock One — solar powered modded server (inspiracja)</li>
        <li>Gaia’s Riddle — edukacyjne scenariusze</li>
        <li>Fun Palace SMP — wydarzenia i warsztaty</li>
      </ul>
    </section> -->

    <!-- ===== AKTUALIZACJE: ładowane dynamicznie z katalogu _posts na GitHubie ===== -->
    <section id="updates-frame" class="card muted" aria-labelledby="updates-heading">
      <h3 id="updates-heading" data-i18n="updates_title">🔔 Aktualizacje projektu</h3>

      <div id="updates-controls" style="display:flex;gap:8px;align-items:center;margin-bottom:10px;justify-content:flex-end;">
        <button id="refresh-posts" class="btn btn-outline" data-i18n="btn_refresh" title="Odśwież listę">Odśwież</button>
        <button id="open-zrzutka" class="btn btn-outline" data-i18n="btn_open_zrzutka" title="Otwórz zrzutkę">Zrzutka (aktualizacje)</button>
      </div>

      <div id="updates-list" style="display:block; gap:12px; overflow:auto; max-height:520px; padding-right:6px;">
        <p class="small">Ładowanie aktualizacji…</p>
      </div>

      <template id="post-card-tpl">
        <article class="post-card card" style="display:block; margin-bottom:12px;">
          <div style="display:flex;gap:12px;">
            </div>
            <div style="flex:1;">
              <div style="display:flex;justify-content:space-between;align-items:start;gap:8px;">
                <div>
                  <h4 class="post-title" style="margin:0 0 6px;font-size:1.05rem"></h4>
                  <div class="small post-meta"></div>
                </div>
                <div>
                  <button class="btn btn-outline btn-open" data-i18n="read_more" style="white-space:nowrap">Czytaj</button>
                </div>
              </div>
              <div class="post-excerpt small" style="margin-top:8px;color:var(--dark);"></div>
              <div class="post-full" style="display:none;margin-top:12px;"></div>
            </div>
          </div>
        </article>
      </template>
    </section>

    <!-- MULTIMEDIA (galeria) -->
    <section id="multimedia" class="card gallery" aria-labelledby="gallery-heading">
      <h3 id="gallery-heading" data-i18n="gallery_title">Galeria / Multimedia</h3>
      <div class="carousel">
        <div class="carousel-track"></div>
      </div>
      <div class="carousel-controls" aria-hidden="false">
        <input type="range" class="carousel-range" min="0" value="0" step="1" />
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="card muted" aria-labelledby="faq-heading">
      <h3 id="faq-heading" data-i18n="faq_title">Najczęstsze pytania (FAQ)</h3>
      <!-- zostanie wygenerowane przez skrypt -->
    </section>

    <!-- SUPPORT -->
    <section id="support" class="card support" aria-labelledby="support-heading">
      <h3 id="support-heading" data-i18n="support_title">Wesprzyj projekt</h3>
      <p data-i18n="support_text">Wesprzyj nas na Zrzutka.pl — każda złotówka przybliża testy zasilania z OZE i rozwój treści edukacyjnych.</p>
      <div class="widget-wrap">
        <div style="position: relative; width: 100%; height: 480px; overflow: hidden;">
          <iframe style="position: absolute; top:0; left: 0; bottom: 0; right: 0; width: 100%; height: 100%;"
            src="https://zrzutka.pl/b5j6vm/widget/13" frameborder="0" scrolling="no" title="Zrzutka widget"></iframe>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact" class="card" aria-labelledby="contact-heading">
      <h3 id="contact-heading" data-i18n="contact_title">Kontakt & społeczność</h3>
      <p data-i18n="contact_text">Discord (wkrótce) • GitHub: <a href="https://github.com/antonihelbigip/EduCraft" target="_blank" rel="noopener">github.com/antonihelbigip/EduCraft</a></p>
    </section>
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="container">
      <small data-i18n="footer_text">© 2025 EduCraft • MIT License • Made by Antoni</small>
    </div>
  </footer>

  <!-- NAV TOGGLE + accessibility helpers -->
  <script>
    (function(){
      const btn = document.querySelector('.nav-toggle');
      const nav = document.querySelector('.main-nav');
      if(!btn || !nav) return;
      btn.addEventListener('click', ()=> {
        const open = nav.classList.toggle('open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
      window.addEventListener('resize', ()=> {
        if(window.innerWidth > 760 && nav.classList.contains('open')) {
          nav.classList.remove('open');
          btn.setAttribute('aria-expanded','false');
        }
      });
      nav.querySelectorAll('a[href^="#"]').forEach(a=>{
        a.addEventListener('click', ()=> {
          if(nav.classList.contains('open')) {
            nav.classList.remove('open');
            btn.setAttribute('aria-expanded','false');
          }
        });
      });
    })();
  </script>

  <!-- GALLERY: ładowanie obrazów z katalogu images na GitHubie -->
  <script>
  (async function(){
    const owner = 'antonihelbigip';
    const repo = 'EduCraft';
    const path = 'images';
    const branch = 'main';
    const gallery = document.querySelector('.gallery');
    if (!gallery) return;
    const track = gallery.querySelector('.carousel-track');
    const range = gallery.querySelector('.carousel-range');
    if (!track || !range) return;
    track.innerHTML = '<p class="small">Ładowanie galerii…</p>';
    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`;
    try {
      const res = await fetch(apiUrl);
      if (!res.ok) throw new Error('GitHub API error: ' + res.status);
      const files = await res.json();
      const imgs = Array.isArray(files) ? files.filter(f => /\.(jpe?g|png|gif|webp|svg)$/i.test(f.name)) : [];
      if (imgs.length === 0) { track.innerHTML = '<p class="small">Brak obrazów w katalogu images/. Dodaj pliki i zrób push.</p>'; range.style.display='none'; return; }
      imgs.sort((a,b)=>a.name.localeCompare(b.name, undefined, {numeric:true}));
      track.innerHTML='';
      const slides = [];
      const rawUrl = (filename)=>`https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${path}/${encodeURIComponent(filename)}`;
      imgs.forEach(file=>{
        const slide=document.createElement('div');
        slide.className='carousel-slide';
        const img=document.createElement('img');
        img.src=rawUrl(file.name);
        img.setAttribute('data-i18n-alt',file.name.replace(/\.[^/.]+$/,'').replace(/[-_]/g,'_'));
        img.loading='lazy';
        slide.appendChild(img);
        track.appendChild(slide);
        slides.push(slide);
      });

      let visible = window.innerWidth <= 760 ? 1 : 2;
      let currentIndex = 0;
      const total = slides.length;
      let maxIndex = Math.max(0,total-visible);
      const rangeUpdate = ()=>{ visible = window.innerWidth<=760?1:2; maxIndex=Math.max(0,total-visible); range.max=maxIndex; if(+range.value>maxIndex) range.value=maxIndex; updatePosition(+range.value);}
      const updatePosition = index=>{currentIndex=index; track.style.transform=`translateX(-${index*(100/visible)}%)`; range.value=index;}
      const setSlideBasis=()=>{const basis=100/visible; slides.forEach(s=>{s.style.flex=`0 0 ${basis}%`; s.style.height=`${s.offsetWidth*0.6}px`}); updatePosition(Math.min(currentIndex,Math.max(0,total-visible)));}
      rangeUpdate(); setSlideBasis();
      let resizeTimer;
      window.addEventListener('resize',()=>{clearTimeout(resizeTimer); resizeTimer=setTimeout(()=>{rangeUpdate(); setSlideBasis();},120);});
      range.addEventListener('input', e=>updatePosition(+e.target.value));

      let autoplayInterval=2500, autoplayTimer=null;
      const startAutoplay=()=>{stopAutoplay(); if(total<=visible)return; autoplayTimer=setInterval(()=>{let next=currentIndex+1;if(next>maxIndex)next=0;updatePosition(next);},autoplayInterval);}
      const stopAutoplay=()=>{if(autoplayTimer){clearInterval(autoplayTimer); autoplayTimer=null;}}
      gallery.addEventListener('mouseenter',stopAutoplay);
      gallery.addEventListener('mouseleave',startAutoplay);
      if(total<=visible){range.style.display='none'; track.style.justifyContent='center'; slides.forEach(slide=>slide.style.flex=`0 0 ${100/total}%`);}else range.style.display='block';
      startAutoplay();

      // ALT translations (puste teraz, można rozszerzyć)
      const TRANSLATIONS_ALT={pl:{},en:{},de:{}};
      const applyAltLanguage=lang=>{slides.forEach(s=>{const img=s.querySelector('img[data-i18n-alt]'); if(!img) return; const key=img.getAttribute('data-i18n-alt'); img.alt=(TRANSLATIONS_ALT[lang]&&TRANSLATIONS_ALT[lang][key])?TRANSLATIONS_ALT[lang][key]:key;});}
      const initLang=localStorage.getItem('educraft_lang')||'pl';
      applyAltLanguage(initLang);
      document.querySelectorAll('.lang-btn').forEach(btn=>{btn.addEventListener('click',()=>applyAltLanguage(btn.dataset.lang));});
    } catch(err){console.error(err); track.innerHTML='<p class="small">Nie udało się załadować galerii. Sprawdź konsolę (F12).</p>'; range.style.display='none';}
  })();
  </script>

  <!-- TRANSLATIONS & DYNAMIC POSTS LOADER -->
  <script>
  /* =====================
     Słownik tłumaczeń (klucze użyte w data-i18n)
     ===================== */
const TRANSLATIONS = {
  pl: {
    nav_about: "O projekcie",
    nav_education: "Edukacja",
    nav_publications: "Publikacje",
    nav_projects: "Projekty",
    nav_multimedia: "Multimedia",
    nav_blog: "Blog",
    nav_contact: "Kontakt",
    hero_title: "EduCraft",
    hero_lead: "Pierwszy w Polsce edukacyjny serwer Minecraft zasilany w 100% energią odnawialną.",
    cta_support: "Wesprzyj",
    cta_about: "Dowiedz się więcej",
    about_title: "O projekcie",
    about_text: "Buduję pierwszy w Polsce edukacyjny serwer Minecraft zasilany w 100% odnawialną energią. To połączenie gier, technologii i ekologii — z misją edukacyjną dla dzieci, młodzieży i dorosłych. Pomóż mi uruchomić ten wyjątkowy projekt i pokażmy, że Minecraft może zmieniać świat!",
    education_title: "Edukacja",
    education_text: "Program edukacyjny zawiera moduły: Energia słoneczna, Energia wiatrowa, Magazynowanie energii, Automatyka i Home Assistant.",
    publications_title: "Publikacje",
    publications_intro: "Lista raportów, artykułów i materiałów edukacyjnych związanych z projektem.",
    creator_title: "Kim jestem?",
    creator_text: "Mam na imię Antoni — jestem studentem mechatroniki na Politechnice Śląskiej, stażystą ds. sztucznej inteligencji w firmie Siemens oraz trzykrotnym laureatem konkursu „Mój pomysł na biznes”. Ten projekt to dla mnie coś więcej niż hobby — to marzenie o łączeniu zabawy z nauką, i realna szansa na pokazanie, że OZE to nie przyszłość – to teraźniejszość.”.",
    build_title: "Co buduję?",
    build_intro: " Otwarto-edukacyjny serwer Minecraft, który:",
    build_li1: "Działa 24/7 dzięki energii z paneli słonecznych",
    build_li2: "Służy jako platforma edukacyjna z zadaniami i grami o OZE, fizyce i automatyce NPC/AI i mapą EarthMC",
    build_li3: "Uczy, jak naprawdę działają systemy energii odnawialnej, system monitoringu energii (Raspberry Pi + Home Assistant)",
    projects_title: "Projekty",
    updates_title: "Aktualizacje",
    updates_open: "Otwórz",
    updates_refresh: "Odśwież",
    gallery_title: "Galeria / Multimedia",
    blog_title: "Blog",
    support_title: "Wesprzyj projekt",
    support_text: "Wesprzyj nas na Zrzutka.pl — każda złotówka przybliża testy zasilania z OZE i rozwój treści edukacyjnych.",
    faq_title: "Najczęstsze pytania (FAQ)",
    contact_title: "Kontakt & społeczność",
    contact_text: "Discord (wkrótce) • GitHub: github.com/antonihelbigip/EduCraft",
    footer_text: "© 2025 EduCraft • MIT License • Made by Antoni",
    // Aktualizacje: UI
    btn_refresh: "Odśwież",
    btn_open_zrzutka: "Zrzutka (aktualizacje)",
    loading_posts: "Ładowanie aktualizacji…",
    no_posts_dir: "Brak wpisów w katalogu _posts.",
    no_posts_for_lang: "Brak wpisów dla języka {LANG}.",
    read_more: "Czytaj więcej",
    show_less: "Zwiń",
    raw_label: "Surowy",
    open_label: "Otwórz",
    load_more: "Więcej",
    // FAQ przykłady
    faq_q1: "Czy serwer będzie darmowy?",
    faq_a1: "Tak — serwer będzie otwarty, bez whitelisty i bez kont premium.",
    faq_q2: "Czy zasilanie OZE będzie realne?",
    faq_a2: "Tak — panele PV, turbina wiatrowa i akumulatory zapewnią zasilanie.",
    faq_q3: "Czy można pomóc?",
    faq_a3: "Tak — planowana rekrutacja przez Discorda.",
    faq_q4: "Co gdy nie zbierzemy całej kwoty?",
    faq_a4: "Realizacja etapami zgodnie z zebranymi środkami.",
    faq_q5: "Jak śledzić postępy?",
    faq_a5: "Postępy będą publikowane na zrzutce i GitHubie.",
    faq_q6: "Czy materiały będą open-source?",
    faq_a6: "Tak — dokumentacja i część materiałów będą open-source.",
    faq_q7: "Czy to tylko zabawa?",
    faq_a7: "Nie — projekt ma cele edukacyjne.",
    faq_q8: "Kto prowadzi projekt?",
    faq_a8: "Antoni — student mechatroniki."
  },
  en: {
    nav_about: "About",
    nav_education: "Education",
    nav_publications: "Publications",
    nav_projects: "Projects",
    nav_multimedia: "Multimedia",
    nav_blog: "Blog",
    nav_contact: "Contact",
    hero_title: "EduCraft",
    hero_lead: "The first Polish educational Minecraft server powered 100% by renewable energy.",
    cta_support: "Support",
    cta_about: "Learn more",
    about_title: "About",
    about_text: "I am building the first educational Minecraft server in Poland powered 100% by renewable energy. It’s a combination of gaming, technology, and ecology — with an educational mission for children, youth, and adults. Help me launch this unique project and let’s show that Minecraft can change the world!",
    education_title: "Education",
    education_text: "Curriculum: Solar energy, Wind energy, Storage, Monitoring and Automation (Home Assistant).",
    publications_title: "Publications",
    publications_intro: "Reports, papers and educational materials related to the project.",
    creator_title: "About the creator",
    creator_text: "My name is Antoni — I am a student of Mechatronics at the Silesian University of Technology, an Artificial Intelligence intern at Siemens, and a three-time winner of the “My Business Idea” competition. This project is more than just a hobby for me — it’s a dream of combining fun with learning, and a real chance to show that renewable energy is not the future – it’s the present..",
    build_title: "What we build",
    build_intro: " An open educational Minecraft server that:",
    build_li1: "24/7 server powered by PV panels ",
    build_li2: "Serves as an educational platform with tasks and games about renewable energy, physics, and automation,, NPC/AI and EarthMC map",
    build_li3: "Teaches how renewable energy systems really work. Energy monitoring system (Raspberry Pi + Home Assistant)",
    projects_title: "Projects",
    updates_title: "Updates",
    updates_open: "Open",
    updates_refresh: "Refresh",
    gallery_title: "Gallery / Multimedia",
    blog_title: "Blog",
    support_title: "Support the project",
    support_text: "Support us on Zrzutka.pl — every contribution helps powering tests and educational content.",
    faq_title: "FAQ",
    contact_title: "Contact & community",
    contact_text: "Discord (coming soon) • GitHub: github.com/antonihelbigip/EduCraft",
    footer_text: "© 2025 EduCraft • MIT License • Made by Antoni",
    btn_refresh: "Refresh",
    btn_open_zrzutka: "Zrzutka (updates)",
    loading_posts: "Loading updates…",
    no_posts_dir: "_posts folder is empty.",
    no_posts_for_lang: "No posts for {LANG}.",
    read_more: "Read more",
    show_less: "Show less",
    raw_label: "Raw",
    open_label: "Open",
    load_more: "More",
    faq_q1: "Will the server be free?",
    faq_a1: "Yes — the server will be open and free.",
    faq_q2: "Is renewable energy feasible?",
    faq_a2: "Yes — PV, wind and batteries will power the server.",
    faq_q3: "Can I help?",
    faq_a3: "Yes — community contributions and volunteers welcome.",
    faq_q4: "What if funding falls short?",
    faq_a4: "We'll deliver features in prioritized stages.",
    faq_q5: "How to follow progress?",
    faq_a5: "Progress will be posted on the crowdfunding page and GitHub.",
    faq_q6: "Will materials be open-source?",
    faq_a6: "Yes — documentation and some materials will be open-source.",
    faq_q7: "Is this just for fun?",
    faq_a7: "No — it's an educational initiative.",
    faq_q8: "Who runs the project?",
    faq_a8: "Antoni — mechatronics student."
  },
  de: {
    nav_about: "Über das Projekt",
    nav_education: "Bildung",
    nav_publications: "Publikationen",
    nav_projects: "Projekte",
    nav_multimedia: "Multimedia",
    nav_blog: "Blog",
    nav_contact: "Kontakt",
    hero_title: "EduCraft",
    hero_lead: "Der erste polnische Bildungs-Minecraft-Server, der zu 100 % mit erneuerbarer Energie betrieben wird.",
    cta_support: "Unterstütze",
    cta_about: "Mehr erfahren",
    about_title: "Über das Projekt",
    about_text: "Ich baue den ersten edukativen Minecraft-Server in Polen, der zu 100 % mit erneuerbarer Energie betrieben wird. Es ist eine Kombination aus Spielen, Technologie und Ökologie — mit einer Bildungsmission für Kinder, Jugendliche und Erwachsene. Hilf mir, dieses einzigartige Projekt zu starten, und zeigen wir, dass Minecraft die Welt verändern kann!",
    education_title: "Bildung",
    education_text: "Lehrplan: Solar, Wind, Speicher, Monitoring und Automatisierung.",
    publications_title: "Publikationen",
    publications_intro: "Berichte, Artikel und Materialien zum Projekt.",
    creator_title: "Über den Ersteller",
    creator_text: "Ich heiße Antoni — ich bin Mechatronik-Student an der Schlesischen Technischen Universität, Praktikant für Künstliche Intelligenz bei Siemens und dreifacher Preisträger des Wettbewerbs „Meine Geschäftsidee“. Dieses Projekt ist für mich mehr als nur ein Hobby — es ist ein Traum, Spiel und Lernen zu verbinden, und eine echte Chance zu zeigen, dass erneuerbare Energien nicht die Zukunft sind – sondern die Gegenwart.",
    build_title: "Was wir bauen",
    build_intro: " Ein offener, edukativer Minecraft-Server, der:",
    build_li1: "24/7 Server, betrieben durch PV-Module ",
    build_li2: "Bildungsplattform mit Aufgaben und Spielen zu erneuerbaren Energien, Physik und Automatisierung dient, NPC/AI und EarthMC-Karte",
    build_li3: " Vermittelt, wie erneuerbare Energiesysteme in der Realität funktionieren. Energiemonitoring-System (Raspberry Pi + Home Assistant)",
    projects_title: "Projekte",
    updates_title: "Aktualisierungen",
    updates_open: "Öffnen",
    updates_refresh: "Aktualisieren",
    gallery_title: "Galerie / Multimedia",
    blog_title: "Blog",
    support_title: "Unterstütze das Projekt",
    support_text: "Unterstütze uns auf Zrzutka.pl — jeder Beitrag hilft.",
    faq_title: "FAQ",
    contact_title: "Kontakt & Community",
    contact_text: "Discord (bald) • GitHub: github.com/antonihelbigip/EduCraft",
    footer_text: "© 2025 EduCraft • MIT License • Made by Antoni",
    btn_refresh: "Aktualisieren",
    btn_open_zrzutka: "Zrzutka (Updates)",
    loading_posts: "Lade Aktualisierungen…",
    no_posts_dir: "_posts Ordner ist leer.",
    no_posts_for_lang: "Keine Einträge für {LANG}.",
    read_more: "Mehr lesen",
    show_less: "Weniger",
    raw_label: "Roh",
    open_label: "Öffnen",
    load_more: "Mehr",
    faq_q1: "Wird der Server kostenlos sein?",
    faq_a1: "Ja — der Server wird offen und kostenlos sein.",
    faq_q2: "Ist erneuerbare Energie realistisch?",
    faq_a2: "Ja — PV, Wind und Akkus werden Energie liefern.",
    faq_q3: "Kann ich helfen?",
    faq_a3: "Ja — Beiträge der Community sind willkommen.",
    faq_q4: "Was, wenn Finanzierung nicht reicht?",
    faq_a4: "Wir priorisieren Funktionen und realisieren etappenweise.",
    faq_q5: "Wie kann ich den Fortschritt verfolgen?",
    faq_a5: "Der Fortschritt wird auf der Crowdfunding-Seite, der Projektseite und Discord veröffentlicht.",
    faq_q6: "Werden Materialien open-source sein?",
    faq_a6: "Ja — ein Teil der Materialien wird Open-Source sein.",
    faq_q7: "Ist das nur zum Spaß?",
    faq_a7: "Nein — dies ist ein Bildungsprojekt.",
    faq_q8: "Wer führt das Projekt?",
    faq_a8: "Antoni — Mechatronik-Student."
  }
};

  /* -------------------------
     Funkcje i18n (zmiana języka)
     ------------------------- */
  function applyLanguage(lang){
    const dict = TRANSLATIONS[lang] || TRANSLATIONS['pl'];
    document.documentElement.lang = lang;

    // zwykłe elementy z data-i18n w DOM
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      if(key && dict[key]) el.textContent = dict[key];
    });

    // template: trzeba podmienić zawartość w samym template (nie jest w DOM)
    const tpl = document.getElementById('post-card-tpl');
    if(tpl && tpl.content) {
      try {
        tpl.content.querySelectorAll('[data-i18n]').forEach(el=>{
          const key = el.getAttribute('data-i18n');
          if(key && dict[key]) el.textContent = dict[key];
        });
      } catch(e) {
        console.warn('applyLanguage: template update failed', e);
      }
    }

    // ręczne dopasowanie kilku kontrolnych elementów
    try {
      const refreshBtn = document.getElementById('refresh-posts');
      if(refreshBtn && dict.btn_refresh) refreshBtn.textContent = dict.btn_refresh;

      const openZrz = document.getElementById('open-zrzutka');
      if(openZrz && dict.btn_open_zrzutka) openZrz.textContent = dict.btn_open_zrzutka;
    } catch(e) {}

    document.querySelectorAll('.lang-btn').forEach(b=>b.classList.toggle('active', b.dataset.lang===lang));
    try{ localStorage.setItem('educraft_lang', lang); } catch(e){}
    loadPosts(lang);
    buildFAQFor(lang);
  }

  (function initLang(){
    const urlParams = new URLSearchParams(window.location.search);
    let lang = urlParams.get('lang') || localStorage.getItem('educraft_lang') || (navigator.language||'pl').slice(0,2);
    if(!['pl','en','de'].includes(lang)) lang='pl';
    applyLanguage(lang);
  })();

  document.querySelectorAll('.lang-btn').forEach(btn=>{
    btn.addEventListener('click', ()=> applyLanguage(btn.dataset.lang));
  });

  /* =========================
     Dynamiczne ładowanie wpisów z GitHub _posts
     ========================= */

  const GH_OWNER = 'antonihelbigip';
  const GH_REPO  = 'EduCraft';
  const GH_REF   = 'main';
  const POSTS_PATH = '_posts';
  const POSTS_API = `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${POSTS_PATH}?ref=${GH_REF}`;
  const RAW_BASE_ROOT = `https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/${GH_REF}/`;

  let _postsCache = null;

  function detectLangFromFilename(filename){
    const m1 = filename.match(/\.([a-z]{2})\.md$/i);
    if(m1) return m1[1].toLowerCase();
    const m2 = filename.match(/[-._]([a-z]{2})\.md$/i);
    if(m2) return m2[1].toLowerCase();
    return null;
  }

  // rozszerzony parser: obsługuje image: oraz images:
  function parseFrontMatter(mdText){
    const m = mdText.match(/^---\s*([\s\S]*?)\s*---/);
    if(!m) return {title:null,date:null,lang:null,images:[]};
    const fm = m[1];
    const result = {images:[]};
    const t = fm.match(/^\s*title:\s*(?:"([^"]+)"|'([^']+)'|(.+))$/m);
    if(t) result.title = (t[1]||t[2]||t[3]||'').trim();
    const d = fm.match(/^\s*date:\s*(.+)$/m);
    if(d) result.date = d[1].trim();
    const l = fm.match(/^\s*lang:\s*([a-zA-Z_-]+)/m);
    if(l) result.lang = l[1].trim().toLowerCase();

    // images: - "a", - "b"
    const imgsBlock = fm.match(/^\s*images:\s*\n((?:\s*-\s*.+\n?)+)/m);
    if(imgsBlock){
      const lines = imgsBlock[1].match(/-\s*(.+)/g) || [];
      result.images = lines.map(s => s.replace(/^\-\s*/,'').trim().replace(/^['"]|['"]$/g,''));
    }

    // single image: "..." or image: /images/...
    const singleImg = fm.match(/^\s*image:\s*(?:"([^"]+)"|'([^']+)'|(.+))$/m);
    if(singleImg){
      const val = (singleImg[1]||singleImg[2]||singleImg[3]||'').trim().replace(/^['"]|['"]$/g,'');
      if(val) result.images.unshift(val);
    }

    return result;
  }

  function resolveImageRawUrl(imgPath){
    if(!imgPath) return '';
    imgPath = imgPath.trim().replace(/^['"]|['"]$/g,'');
    if(imgPath.startsWith('/')) imgPath = imgPath.replace(/^\/+/, '');
    if(/(^|\/)images\//i.test(imgPath)){
      return RAW_BASE_ROOT + encodeURI(imgPath);
    }
    if(/^https?:\/\//i.test(imgPath)) return imgPath;
    return RAW_BASE_ROOT + 'images/' + encodeURIComponent(imgPath);
  }

  function safeRenderMarkdown(md){
    try{
      return marked.parse(md || '');
    } catch(e){
      return (md||'').replace(/\n/g,'<br>');
    }
  }

  async function loadPosts(lang){
    lang = (lang || localStorage.getItem('educraft_lang') || (navigator.language||'pl').slice(0,2)).slice(0,2);
    const dict = TRANSLATIONS[lang] || TRANSLATIONS['pl'];
    const updatesList = document.getElementById('updates-list');
    const tpl = document.getElementById('post-card-tpl');
    if(!updatesList || !tpl) return;
    updatesList.innerHTML = `<p class="small">${dict.loading_posts || 'Ładowanie aktualizacji…'}</p>`;

    try{
      const res = await fetch(POSTS_API);
      if(!res.ok) throw new Error('GitHub API: ' + res.status);
      const files = await res.json();
      const mdFiles = Array.isArray(files) ? files.filter(f=>/\.md$/i.test(f.name)) : [];
      if(mdFiles.length===0){
        updatesList.innerHTML = `<p class="small">${dict.no_posts_dir || 'Brak wpisów w katalogu _posts.'}</p>`;
        return;
      }

      const fetches = mdFiles.map(f => fetch(f.download_url).then(r=>{
        if(!r.ok) throw new Error('raw fetch ' + r.status);
        return r.text().then(txt => ({name: f.name, text: txt}));
      }).catch(e=>{
        console.warn('fetch error', f.name, e);
        return null;
      }));

      const all = (await Promise.all(fetches)).filter(Boolean);

      const posts = all.map(o=>{
        const fm = parseFrontMatter(o.text);
        const body = o.text.replace(/^---[\s\S]*?---\s*/,'').trim();
        const langFromFile = detectLangFromFilename(o.name);
        const finalLang = fm.lang ? fm.lang.toLowerCase() : (langFromFile || 'pl');
        return { filename: o.name, title: fm.title || null, date: fm.date || null, lang: finalLang, images: fm.images || [], body };
      }).filter(p=> p && p.lang && p.lang.slice(0,2) === (lang || 'pl'));

      if(posts.length === 0){
        const msg = (dict.no_posts_for_lang || 'Brak wpisów dla języka {LANG}.').replace('{LANG}', lang.toUpperCase());
        updatesList.innerHTML = `<p class="small">${msg}</p>`;
        return;
      }

      posts.sort((a,b)=>{
        const da = new Date(a.date || a.filename.slice(0,10));
        const db = new Date(b.date || b.filename.slice(0,10));
        return db - da;
      });

      updatesList.innerHTML = '';
      posts.forEach(p=>{
        const node = tpl.content.cloneNode(true);
        const imgEl = node.querySelector('img');
        const thumbWrap = node.querySelector('.post-thumb');
        const titleEl = node.querySelector('.post-title');
        const metaEl = node.querySelector('.post-meta');
        const excerptEl = node.querySelector('.post-excerpt');
        const fullEl = node.querySelector('.post-full');
        const btnOpen = node.querySelector('.btn-open');

        titleEl.textContent = p.title || p.filename;
        metaEl.textContent = (p.date ? new Date(p.date).toLocaleString() : '') + (p.lang ? ' • ' + p.lang.toUpperCase() : '');

        // thumb: jeśli brak -> ukryj cały kontener .post-thumb (nie pokazujemy placeholdera)
        const thumb = (p.images && p.images.length>0) ? resolveImageRawUrl(p.images[0]) : '';
        if(thumb){
          if(imgEl){
            imgEl.src = thumb;
            imgEl.alt = p.title || '';
            imgEl.style.display = '';
            if(thumbWrap) thumbWrap.style.display = '';
          }
        } else {
          // ukryj cały kontener miniaturki tak, żeby nie było tekstu "EduCraft"
          if(thumbWrap) thumbWrap.style.display = 'none';
          if(imgEl) { imgEl.removeAttribute('src'); imgEl.alt = ''; imgEl.style.display = 'none'; }
        }

        const plain = (p.body || '').replace(/!\[.*?\]\(.*?\)/g,'').replace(/\[([^\]]+)\]\([^\)]+\)/g,'$1').replace(/[#>*`]/g,'').trim();
        excerptEl.textContent = plain.length>240 ? plain.slice(0,240).trim()+'…' : plain;

        let body = p.body || '';
        body = body.replace(/!\[([^\]]*)\]\((\/?images\/)?([^)\/\s]+)\)/g, (m,alt,maybe,filename)=>{
          const resolved = resolveImageRawUrl(filename);
          return `![${alt}](${resolved})`;
        });
        fullEl.innerHTML = safeRenderMarkdown(body);

        // ustawienie tekstu przycisku z tłumaczenia (używamy dict aby trzymać lokalizację)
        btnOpen.textContent = (dict && dict.read_more) ? dict.read_more : 'Czytaj więcej';

        // obsługa Czytaj/Zwiń (toggle)
        btnOpen.addEventListener('click', ()=>{
          const dictLocal = TRANSLATIONS[document.documentElement.lang] || TRANSLATIONS.pl;
          const isOpen = fullEl.classList.toggle('open');
          if(isOpen){
            fullEl.style.display = 'block';
            btnOpen.textContent = dictLocal.show_less || 'Zwiń';
            fullEl.scrollIntoView({behavior:'smooth', block:'nearest'});
          } else {
            fullEl.style.display = 'none';
            btnOpen.textContent = dictLocal.read_more || 'Czytaj więcej';
          }
        });

        updatesList.appendChild(node);
      });

    } catch(err){
      console.error('loadPosts error', err);
      updatesList.innerHTML = `<p class="small">${(TRANSLATIONS.pl && TRANSLATIONS.pl.loading_posts) ? TRANSLATIONS.pl.loading_posts : 'Nie udało się załadować wpisów.'}</p>`;
    }
  }

  // Podłącz kontrolki: Odśwież i Otwórz Zrzutkę
  try {
    document.getElementById('open-zrzutka').addEventListener('click', ()=> {
      window.open('https://zrzutka.pl/zbudujmy-1-w-polsce-edukacyjny-eco-serwer-minecraft-z-oze-b5j6vm#updates','_blank','noopener');
    });
  } catch(e){}

  try {
    document.getElementById('refresh-posts').addEventListener('click', ()=>{
      _postsCache = null;
      const lang = localStorage.getItem('educraft_lang') || document.documentElement.lang || 'pl';
      loadPosts((lang||'pl').slice(0,2));
    });
  } catch(e){}

  // automatyczne przeładowanie po zmianie języka (przycisk w topbar)
  document.querySelectorAll('.lang-btn').forEach(b=> b.addEventListener('click', ()=> {
    setTimeout(()=> {
      const lang = localStorage.getItem('educraft_lang') || document.documentElement.lang || 'pl';
      loadPosts((lang||'pl').slice(0,2));
    }, 80);
  }));

  // Inicjalne załadowanie wpisów (jeśli jeszcze nie załadowano)
  (function tryInitPosts(){
    const list = document.getElementById('updates-list');
    if(list && list.innerHTML.trim().includes('Ładowanie aktualizacji')) {
      const lang = localStorage.getItem('educraft_lang') || document.documentElement.lang || 'pl';
      loadPosts((lang||'pl').slice(0,2));
    }
  })();

  // =========================
  // FAQ dynamic build (na podstawie TRANSLATIONS)
  // =========================
  function buildFAQFor(lang){
    const dict = TRANSLATIONS[lang] || TRANSLATIONS['pl'];
    const faq = document.getElementById('faq');
    if(!faq) return;
    faq.querySelectorAll('details').forEach(d=>d.remove());
    for(let i=1;i<=8;i++){
      const qKey = 'faq_q'+i;
      const aKey = 'faq_a'+i;
      if(dict[qKey] && dict[aKey]){
        const details = document.createElement('details');
        const summary = document.createElement('summary');
        summary.textContent = dict[qKey];
        const p = document.createElement('p');
        p.textContent = dict[aKey];
        details.appendChild(summary);
        details.appendChild(p);
        faq.appendChild(details);
      }
    }
  }

  // podmiana smooth scroll dla anchorów (uwzględnia sticky topbar)
  document.querySelectorAll('a[href^="#"]').forEach(a=>{
    a.addEventListener('click', function(e){
      const href = this.getAttribute('href');
      if(!href || href === "#") return;
      const target = document.querySelector(href);
      if(!target) return;
      e.preventDefault();
      const headerOffset = document.querySelector('.topbar') ? document.querySelector('.topbar').offsetHeight : 72;
      const rect = target.getBoundingClientRect();
      const offsetTop = window.pageYOffset + rect.top - headerOffset - 12;
      window.scrollTo({ top: offsetTop, behavior: 'smooth' });
    });
  });

  </script>
</body>
</html>
